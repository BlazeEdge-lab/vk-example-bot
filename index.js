// –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –∫–æ—Ç–æ—Ä–∞—è –æ–±–ª–µ–≥—á–∏—Ç —Ä–∞–±–æ—Ç—É —Å API –í–ö
const config = require("./config.json"), // –∫–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª
    { VK } = require('vk-io'), // —Å–∞–º–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
    { HearManager } = require('@vk-io/hear'); // –£–¥–æ–±–µ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞

// –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ –ø–µ—Ä–µ–¥–∞–≤ –≤ –Ω–µ–≥–æ –Ω–∞—à —Ç–æ–∫–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API, –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º —ç—Ç–æ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –Ω–∞–º –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π
const vk = new VK({
    token: config.token
});

const command = new HearManager(); // –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä

vk.updates.on('message', command.middleware); // –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç HearManager –ø—Ä–æ—Å–ª—É—à–∏–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

// –ü–æ–ª—É—á–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, —Ç–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (—Ç–æ –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤–∫, –ª–∏–±–æ –Ω–∞–π—Ç–∏ –≤—Å–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ vk-io
vk.updates.on('message', async (context, next) => {
    console.log('–ü—Ä–∏—à–ª–æ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!'); // –í—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏—à–ª–æ —Å–æ–±—ã—Ç–∏–µ
    await next(); // –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å next —Ñ—É–Ω–∫—Ü–∏—é.
});

// –°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ—Å–ª—É—à–∏–≤–∞—Ç–µ–ª—è –∫–æ–º–∞–Ω–¥—ã /start –∏ –æ—Ç–≤–µ—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –∫–æ–º–∞–Ω–¥—ã
command.hear('/start', async (context) => {
    context.send('–≠—Ç–æ –Ω–∞—à–∞ –ø–µ—Ä–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∏ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç üéâ');
})

// –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –∏ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å —Å –ø–æ–º–æ—â—å—é catch
vk.updates.start()
    .then(() => console.log('–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!'))
    .catch(console.error);
